\section{Implementation}

Our implementation is based on an extension of Lombok. The Lombok
project~\cite{lombok} is a Java library that aims at removing (or
reducing) Java boilerplate code via
annotations. There are a number of annotations provided by the
original Lombok, including \Q:@Getter:, \Q:@Setter:,
\Q:@ToString: for generating getters, setters and \QM{toString}
methods, respectively.  Furthermore, Lombok provides a number of
interfaces for users to create custom transformations, as extensions
to the original framework.
A transformation is based on a handler, which acts on the AST for the
annotated node and returns a modified AST for analysis and
generation afterwards. Such a handler can either be a Javac handler or
an Eclipse handler.

The annotation we created is \mixin. In Eclipse, with an interface annotated by
\mixin, the automatic annotation processing is performed transparently and the information of
the interface from compilation is captured in the ``Outline'' window. This includes
all the methods inside the interface as well as the generated ones.  The custom
transformation is easy and convenient to use.  For example this means that the
IDE functionality for content assist and autocomplete will work for the newly generated
methods. The biggest reasons to use Lombok rather than using a conventional Java
 annotation processor are:
\begin{itemize}
%this seamd like a commercial spot
%\item Lombok is byte-code based instead of source-code based, which makes client
%  code concise and easy to maintain. Such code generation is performed at
%  compile time to modify bytecode.
\item Lombok modifies the generation process of the class files, by directly modifying the AST.
Neither the source code is modified nor new Java files are generated.
\item Moreover, and probably more importantly, Lombok is capable of generating
  code \emph{inside} a class/interface, which conventional
  Java annotation processors do not support.
\end{itemize}

\paragraph{Limitations}
Our prototype implementation using Lombok has certain limitations:
\begin{itemize}
\item The prototype does not support separate compilation yet. Currently all
  related interfaces have to appear in a single Java file. Therefore, changes to
  a single interface would require re-compiling the whole file. This compilation
  limitation is not caused by our algorithm. It is a Lombok implementation related
  issue: in Lombok it is hard to capture a type declaration from its reference,
  even harder when the type declaration is in other files (we have not found a
  way to do this yet).
\item At this stage our implementation only realizes the Eclipse handler and our
  experiments are all conducted in Eclipse. The implementation for
  \texttt{javac} is missing.
\item The current implementation does not take type-parameters into
  consideration, thus it does not support generics yet.
\end{itemize}

\paragraph{Comparison with other Lombok annotations}
The Lombok project provides a set of predefined annotations, including constructor
generators similar as ours (e.g., \Q:@NoArgsConstructor:,
\Q:@RequiredArgsConstructor: and \Q:@AllArgsConstructor:). They
generate various kinds of constructors for \emph{classes}, with or without
constructor arguments. This set of annotations is of great use, especially when
used together with other features provided in Lombok (e.g.,
\Q:@Data:). Moreover, the implementation of these annotations in Lombok
gives us hints on how to implement \mixin. However, none of these annotations
can model what we are doing with \mixin - generating constructor-methods
(\textbf{of}) for \emph{interfaces}. Apart from constructors, \mixin also
provides other convenient features (including generating fluent setters, type
refinement,etc), which the base Lombok project does not provide.
Finally, while \mixin is formalized, none of Lombok's annotations have been
studied in a formal way.

\paragraph{Lombok does Language tuning}
We consider Lombok to be the most developed example of language
tuning.  While the authors of Lombok do not introduce a specific term
for what they are doing, their slogan \emph{``Spice up your java''}
seems to be in line with the philosophy of language tuning. Some
other examples of language tuning in Lombok include the \Q@val@ type,
similar to \Q@auto@ in C\# or C++04.  Another library doing language
tuning is CoFoJa~\cite{cofoja}, where annotations are used to insert
pre-post conditions in generated bytecode.


